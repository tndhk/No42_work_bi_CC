==============================================================================
コードマップ差分レポート
生成日時: 2026-01-31
==============================================================================

状態: 初回生成 (既存コードマップなし)

------------------------------------------------------------------------------
生成されたファイル
------------------------------------------------------------------------------

[NEW] codemaps/architecture.md
  - 全体アーキテクチャ、システム構成図、サービス間通信
  - 7サービス (frontend, api, executor, dynamodb, minio, 初期化x2)
  - 主要依存ライブラリ一覧 (Backend/Frontend/Executor)
  - 環境変数リファレンス

[NEW] codemaps/backend.md
  - FastAPI バックエンド構造
  - 22 APIルート (auth:3, datasets:6, cards:7, dashboards:6)
  - 依存関係グラフ (routes -> services -> repositories -> models)
  - BaseRepository パターン、DI、セキュリティ

[NEW] codemaps/frontend.md
  - React + TypeScript フロントエンド構造
  - 10 ルート (login + 9 認証必要ページ)
  - 20 hooks (query + mutation)
  - コンポーネント依存関係グラフ
  - 状態管理 (Zustand + React Query)

[NEW] codemaps/data.md
  - 4 DynamoDBテーブル + 4 GSI
  - Pydantic モデル全量 (5エンティティ: User, Dataset, Card, Dashboard, common)
  - Executor モデル (3モデル)
  - TypeScript 型定義 (5ファイル: api, user, dataset, card, dashboard)
  - 9 Type Guard 関数
  - エンティティ関係図

------------------------------------------------------------------------------
スキャン統計
------------------------------------------------------------------------------

Backend (app/):
  ソースファイル:      36 (.py)
  ルートモジュール:     4 (auth, datasets, cards, dashboards)
  モデルモジュール:     5 (common, user, dataset, card, dashboard)
  リポジトリ:          5 (base, user, dataset, card, dashboard)
  サービス:            6 (card_execution, csv_parser, dashboard, dataset, parquet_storage, type_inferrer)
  コアモジュール:      4 (config, security, logging, password_policy)
  DB接続:              2 (dynamodb, s3)

Frontend (src/):
  ソースファイル:      61 (.ts/.tsx)
  ページ:              9
  コンポーネント:     19 (common:8, card:2, dashboard:4, ui:12 ※ui は shadcn/ui)
  Hooks:               4 ファイル → 20 export 関数
  API クライアント:    5 (base + auth, cards, dashboards, datasets)
  型定義:              5 ファイル → 30+ 型/interface
  ストア:              1 (auth-store)

Executor (app/):
  ソースファイル:       6 (.py)
  APIルート:            2 (health, execute/card)
  コアモジュール:       4 (main, runner, sandbox, resource_limiter)
  モデル:               2 (models, api_models)

Tests:
  Backend:             存在 (tests/ ディレクトリ)
  Frontend:            存在 (__tests__/ ディレクトリ)
  Executor:            6 テストファイル

Scripts:
  init_tables.py:      DynamoDB 4テーブル初期化
  Dockerfile.init:     初期化コンテナ

Docs:
  9 ドキュメント:      api-spec, CONTRIB, data-flow, deployment,
                        design, requirements, RUNBOOK, security, tech-spec

------------------------------------------------------------------------------
検出された構造パターン
------------------------------------------------------------------------------

1. リポジトリパターン
   BaseRepository[T] ジェネリック基底クラス + 各エンティティ固有リポジトリ
   自動 snake_case <-> camelCase 変換、タイムスタンプ管理

2. サービスレイヤー
   Routes -> Services -> Repositories の3層アーキテクチャ
   CardExecutionService はリトライ + キャッシュ付き外部HTTP呼び出し

3. 認証
   JWT (HS256) + bcrypt + HTTPBearer + レート制限 (slowapi)

4. フロントエンド状態管理
   Zustand (クライアント状態: 認証) + React Query (サーバ状態: CRUD)

5. セキュアコード実行
   Executor: builtins ブロック、import ブロック、タイムアウト、メモリ制限
   Frontend: iframe sandbox + CSP

------------------------------------------------------------------------------
注意事項
------------------------------------------------------------------------------

- Executor の dataset_rows は将来拡張用で、現在 None 固定
- Frontend の types には OwnerRef, GroupRef 等 Backend 側に対応モデルが無い型がある
  (将来のグループ機能を見据えた先行定義と思われる)
- dashboardsApi.clone() は Backend 側に対応ルートが無い (未実装)
- Frontend の lib/api/auth.ts は ApiResponse<T> ラッパーを期待するが、
  Backend は直接モデルを返している (ラッパー不一致の可能性)

==============================================================================
